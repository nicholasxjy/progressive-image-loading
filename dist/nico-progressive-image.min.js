!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).NProgressiveImage=t()}(this,function(){"use strict";var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},o=NaN,a="[object Symbol]",s=/^\s+|\s+$/g,d=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,c=/^0o[0-7]+$/i,u=parseInt,t="object"==typeof e&&e&&e.Object===Object&&e,n="object"==typeof self&&self&&self.Object===Object&&self,i=t||n||Function("return this")(),h=Object.prototype.toString,y=Math.max,b=Math.min,w=function(){return i.Date.now()};function x(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function I(e){if("number"==typeof e)return e;if("symbol"==typeof(t=e)||(n=t)&&"object"==typeof n&&h.call(t)==a)return o;var t,n;if(x(e)){var i="function"==typeof e.valueOf?e.valueOf():e;e=x(i)?i+"":i}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(s,"");var r=l.test(e);return r||c.test(e)?u(e.slice(2),r?2:8):d.test(e)?o:+e}var r=function(i,r,e){var o,a,s,d,l,c,u=0,h=!1,f=!1,t=!0;if("function"!=typeof i)throw new TypeError("Expected a function");function m(e){var t=o,n=a;return o=a=void 0,u=e,d=i.apply(n,t)}function p(e){var t=e-c;return void 0===c||r<=t||t<0||f&&s<=e-u}function g(){var e,t,n=w();if(p(n))return v(n);l=setTimeout(g,(t=r-((e=n)-c),f?b(t,s-(e-u)):t))}function v(e){return l=void 0,t&&o?m(e):(o=a=void 0,d)}function n(){var e,t=w(),n=p(t);if(o=arguments,a=this,c=t,n){if(void 0===l)return u=e=c,l=setTimeout(g,r),h?m(e):d;if(f)return l=setTimeout(g,r),m(c)}return void 0===l&&(l=setTimeout(g,r)),d}return r=I(r)||0,x(e)&&(h=!!e.leading,s=(f="maxWait"in e)?y(I(e.maxWait)||0,r):s,t="trailing"in e?!!e.trailing:t),n.cancel=function(){void 0!==l&&clearTimeout(l),o=c=a=l=void(u=0)},n.flush=function(){return void 0===l?d:v(w())},n};function f(e,t,n,i,r,o){var J=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],K=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];"string"==typeof e&&(e=document.getElementById(e)),"string"==typeof t&&(t=document.getElementById(t)),r=r||10,t.width=n,t.height=i;var a=t.getContext("2d");if(a.clearRect(0,0,n,i),a.drawImage(e,0,0),!(isNaN(r)||r<1)){var Q=function(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null};!function(e,t,n,i,r,o,a){var s;o|=0;try{s=e.getImageData(t,n,i,r)}catch(e){throw new Error("unable to access image data: "+e)}var d,l,c,u,h,f,m,p,g,v,y,b,w,x,I,E,j,S,T,C,L,z,A,R,N,O=s.data,B=o+o+1,D=i-1,W=r-1,$=o+1,q=$*($+1)/2,k=new Q,H=k;for(c=1;c<B;c++)H=H.next=new Q,c==$&&(N=H);H.next=k;var M=null,F=null;m=f=0;var P=J[o],G=K[o];for(l=0;l<r;l++){for(E=j=S=T=p=g=v=y=0,b=$*(C=O[f]),w=$*(L=O[f+1]),x=$*(z=O[f+2]),a&&(I=$*(A=O[f+3])),p+=q*C,g+=q*L,v+=q*z,a&&(y+=q*A),H=k,c=0;c<$;c++)H.r=C,H.g=L,H.b=z,a&&(H.a=A),H=H.next;for(c=1;c<$;c++)u=f+((D<c?D:c)<<2),p+=(H.r=C=O[u])*(R=$-c),g+=(H.g=L=O[u+1])*R,v+=(H.b=z=O[u+2])*R,a&&(y+=(H.a=A=O[u+3])*R),E+=C,j+=L,S+=z,a&&(T+=A),H=H.next;for(M=k,F=N,d=0;d<i;d++)a?(O[f+3]=A=y*P>>G,0!=A?(A=255/A,O[f]=(p*P>>G)*A,O[f+1]=(g*P>>G)*A,O[f+2]=(v*P>>G)*A):O[f]=O[f+1]=O[f+2]=0):(O[f]=p*P>>G,O[f+1]=g*P>>G,O[f+2]=v*P>>G),p-=b,g-=w,v-=x,a&&(y-=I),b-=M.r,w-=M.g,x-=M.b,a&&(I-=M.a),u=m+((u=d+o+1)<D?u:D)<<2,E+=M.r=O[u],j+=M.g=O[u+1],S+=M.b=O[u+2],a&&(T+=M.a=O[u+3]),p+=E,g+=j,v+=S,a&&(y+=T),M=M.next,b+=C=F.r,w+=L=F.g,x+=z=F.b,a&&(I+=A=F.a),E-=C,j-=L,S-=z,a&&(T-=A),F=F.next,f+=4;m+=i}for(d=0;d<i;d++){for(j=S=T=E=g=v=y=p=0,b=$*(C=O[f=d<<2]),w=$*(L=O[f+1]),x=$*(z=O[f+2]),a&&(I=$*(A=O[f+3])),p+=q*C,g+=q*L,v+=q*z,a&&(y+=q*A),H=k,c=0;c<$;c++)H.r=C,H.g=L,H.b=z,a&&(H.a=A),H=H.next;for(h=i,c=1;c<=o;c++)f=h+d<<2,p+=(H.r=C=O[f])*(R=$-c),g+=(H.g=L=O[f+1])*R,v+=(H.b=z=O[f+2])*R,a&&(y+=(H.a=A=O[f+3])*R),E+=C,j+=L,S+=z,a&&(T+=A),H=H.next,c<W&&(h+=i);for(f=d,M=k,F=N,l=0;l<r;l++)u=f<<2,a?(O[u+3]=A=y*P>>G,0<A?(A=255/A,O[u]=(p*P>>G)*A,O[u+1]=(g*P>>G)*A,O[u+2]=(v*P>>G)*A):O[u]=O[u+1]=O[u+2]=0):(O[u]=p*P>>G,O[u+1]=g*P>>G,O[u+2]=v*P>>G),p-=b,g-=w,v-=x,a&&(y-=I),b-=M.r,w-=M.g,x-=M.b,a&&(I-=M.a),u=d+((u=l+$)<W?u:W)*i<<2,p+=E+=M.r=O[u],g+=j+=M.g=O[u+1],v+=S+=M.b=O[u+2],a&&(y+=T+=M.a=O[u+3]),M=M.next,b+=C=F.r,w+=L=F.g,x+=z=F.b,a&&(I+=A=F.a),E-=C,j-=L,S-=z,a&&(T-=A),F=F.next,f+=i}e.putImageData(s,t,n)}(a,0,0,n,i,r,o)}}!function(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===n&&i.firstChild?i.insertBefore(r,i.firstChild):i.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}}(".nprogressive-image-item {\n  position: relative;\n  z-index: 10;\n}\n\n.nprogressive-image {\n  display: none;\n}\n\n.nprogressive-image-item > canvas {\n  width: 100%;\n  height: 100%;\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  z-index: 11;\n  visibility: visible;\n  opacity: 1;\n  -webkit-transition: all 0.1s ease 0.4s;\n  transition: all 0.1s ease 0.4s;\n}\n.nprogressive-source-image {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  z-index: 12;\n  visibility: hidden;\n  opacity: 0;\n  -webkit-transition: all 0.4s ease;\n  transition: all 0.4s ease;\n}\n.nprogressive-image-item.is--loaded .nprogressive-source-image {\n  visibility: visible;\n  opacity: 1;\n}\n.nprogressive-image-item.is--loaded > canvas {\n  visibility: hidden;\n  opacity: 0;\n}\n");var m={container:"",items:"",offsetTop:10,blurRadius:10,widthAttr:"data-width",heightAttr:"data-height"};return function(){function e(e){if(!e.container)throw new Error("container need to be set!");"string"==typeof e.container?this.container=document.querySelector(e.container):this.container=e.container,e.items&&Array.isArray(e.items)?this.items=e.items:e.items&&"string"==typeof e.items?this.items=this.container.querySelectorAll(e.items):this.items=this.container.querySelectorAll("img"),this.option=Object.assign({},m,e),this.handleScroll=this.handleScroll.bind(this),this.handleResize=this.handleResize.bind(this),this.init(),this.attachEvents(),this.loadItems()}var t=e.prototype;return t.init=function(){for(var e=[],t=this.container.getBoundingClientRect(),n=this.items.length,i=0;i<n;i++){var r=this.items[i],o=this.createItemTemplate(r),a=this.setDimension(o,r,t.width),s=a.w,d=a.h;f(r,o.canvas,parseInt(s/10),parseInt(d/10),this.option.blurRadius),e.push({el:o.div,src:r.getAttribute("data-src"),isLoaded:!1,isError:!1})}this.items=e},t.createItemTemplate=function(e){var t=document.createElement("div");t.classList.add("nprogressive-image-item");var n=document.createElement("canvas");return e.parentNode.replaceChild(t,e),t.appendChild(e),t.appendChild(n),{div:t,canvas:n}},t.setDimension=function(e,t,n){var i=parseInt(t.getAttribute("data-width"),10)||0,r=parseInt(t.getAttribute("data-height"),10)||0,o=i,a=r;return n<=i&&(o=n,a=parseInt(r*o/i)),e.div.style.width=o+"px",e.div.style.height=a+"px",e.canvas.width=parseInt(o/10),e.canvas.height=parseInt(a/10),{w:o,h:a}},t.attachEvents=function(){window.addEventListener("scroll",this.handleScroll,!1),window.addEventListener("resize",this.handleResize,!1)},t.handleScroll=function(){this.loadItems()},t.handleResize=function(){this.loadItems()},t.loadItems=function(){for(var e,t,n=this.items,i=0,r=n.length;i<r;i++)n[i].isLoaded||n[i].isError||(e=n[i].el,void 0,0<=(t=e.getBoundingClientRect()).top&&0<=t.left&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)&&this.loadImage(n[i]))},t.loadImage=function(e){e.el.classList.add("is--loading");var t=new Image;t.onload=function(){t.classList.add("nprogressive-source-image"),e.isLoaded=!0,e.el.appendChild(t),e.el.classList.add("is--loaded")},t.onerror=function(){e.isError=!0},t.src=e.src},t.destroy=function(){window.addEventListener("scroll",r(this.handleScroll,250),!1),window.addEventListener("resize",r(this.handleResize,250),!1)},e}()});
